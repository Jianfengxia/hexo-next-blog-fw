---
title: "*笔记-开发自己的 composer 包"
date: 2017-04-05 08:00:00
updated: 2017-04-07 09:30:19
tags: ["Web"]
---
{% raw %}
<p>composer 是 PHP 的依赖管理工具，本篇文章就来说明如何构建一个包，并提交到 Packagist ，这样别人就可以方便地通过 composer 使用你的包了。</p><p><br/></p><p>开发 composer 包有以下几个步骤：</p><p><br/></p><p>初始化 composer.json 文件</p><p>定义命名空间及包名</p><p>实现包需要实现的功能</p><p>提交到 GitHub</p><p>在 Packagist 注册包</p><p>初始化 composer.json 文件</p><p><br/></p><p>安装好 composer 后即可在本地运行 composer init 通过交互式命令行设置 composer.json 。</p><p><br/></p><p>下面介绍其中的几个属性，以及常规的设置：</p><p><br/></p><p>name&nbsp;</p><p>此属性定义包名，以 / 隔开，前面的为供应商名字，后面为包名，供应商代表 Packagist 网站为开发者提供的唯一的名字，用来组织包以及防止命名冲突。所以提交时最好先访问 https://packagist.org/packages/yourvendorname 将 url 中的 yourvendorname 替换为你想要取的名字，如果页面没有 404 ，说明已经被注册了。</p><p>license&nbsp;</p><p>许可证。关于许可证，建议看两篇文章，<a href="http://choosealicense.com/" target="_blank" rel="nofollow,noindex" style="color: rgb(148, 148, 148); text-decoration: none; transition: 0.25s; outline: 0px; border-bottom: 1px dashed rgb(148, 148, 148); font-style: italic; font-weight: bold; font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; white-space: normal; widows: 1; background-color: rgb(254, 254, 254);">开源项目 license 介绍</a><span style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; widows: 1; background-color: rgb(254, 254, 254);">&nbsp;、&nbsp;</span><a href="http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html" target="_blank" rel="nofollow,noindex" style="color: rgb(148, 148, 148); text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom: 1px dashed rgb(148, 148, 148); font-style: italic; font-weight: bold; font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; white-space: normal; widows: 1; background-color: rgb(254, 254, 254);">如何选择 license</a></p><p>require&nbsp;</p><p>安装当前包所需的依赖。只有所有依赖被安装当前包才会被安装。</p><p>autoload&nbsp;</p><p>此配置下主要是 PSR-4 或者 PSR-0 设置，更推荐使用 PSR-4 标准。</p><p>http://json-schema.org/ 上介绍了 JSON Schema 的定义以及各个语言对其各种功能的实现，有 validator 的实现，其中<a href="http://www.jsonschemavalidator.net/" target="_blank" rel="nofollow,noindex" style="color: rgb(148, 148, 148); text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom: 1px dashed rgb(148, 148, 148); font-style: italic; font-weight: bold; font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; text-indent: 16px; white-space: normal; widows: 1; background-color: rgb(254, 254, 254);">JSON Schema Validator</a><span style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; text-indent: 16px; widows: 1; background-color: rgb(254, 254, 254);">&nbsp;</span>是在线的验证服务。其实最简单的就是使用 composer validate composer.json 来验证文件是否是有错误。</p><p><br/></p><p>这是我演示的设置 composer.json 的视频</p><p><br/></p><p>项目结构</p><p><br/></p><p>以 <a href="https://packagist.org/packages/geosso/geosso" target="_blank" rel="nofollow,noindex" style="color: rgb(148, 148, 148); text-decoration: none; transition: 0.25s; outline: none 0px; border-bottom: 1px dashed rgb(148, 148, 148); font-style: italic; font-weight: bold; font-family: &quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif; line-height: 27.2px; text-indent: 16px; white-space: normal; widows: 1; background-color: rgb(254, 254, 254);">单点登录 SDK</a>&nbsp;为例，此项目基于 Laravel ，实现了站点接入单点登录系统的简单接入，应用只需在服务端注册并实现指定接口，即可接入 SSO 。</p><p><br/></p><p>项目结构是典型的 MVC 结构，</p><p><br/></p><p>.</p><p>└── geo</p><p>&nbsp; &nbsp; └── geosso</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ├── LICENSE</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ├── README.md</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ├── composer.json</p><p>&nbsp; &nbsp; &nbsp; &nbsp; └── src</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├── Contracts</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├── Http</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; │ &nbsp; ├── Controllers</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; │ &nbsp; ├── Middleware</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; │ &nbsp; └── Requests</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├── ParamsBean</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├── Providers</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├── Support</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; └── config</p><p><br/></p><p>12 directories</p><p>LICENSE、README.md 及 composer.json 是运行 tree -d 之后手工添加上去的。</p><p><br/></p><p>项目根目录定义在 src 下，在 composer.json 中也有定义，这样当 composer 加载这个包时就知道如何通过命名空间去解析文件路径。</p><p><br/></p><p>Http 目录代表请求响应，之下的 Controllers 表示合法请求的控制器，Middleware 代表请求的第一道关卡，通过中间件去拦截请求，Requests 去获取前端请求并对请求过滤。</p><p><br/></p><p>Contracts 代表接口定义。ParamsBean 代表应用层与底层服务沟通时的参数封装，通过 Bean 去获取各个参数，而不是传递 array 使得调用一致，并且强制接口调用时做类型检测，可以很大程度上统一各层之间的参数传递。</p><p><br/></p><p>Providers 代表 Laravel 的服务容器，通过服务容器，可以注册路由与配置，加载助手类，绑定接口与其实现。</p><p><br/></p><p>Support 就是一些助手类，对常用的与逻辑无关的功能的封装，config 代表应用自己的配置，通过 config 可以方便地将配置设置并使用全局函数 config() 调用。</p><p><br/></p><p>提交至 GitHub</p><p><br/></p><p>按照前面的步骤，一个包就有了基本的骨架，接下来就是上传至 GitHub ，配置项目，集成持续集成服务，发布开源项目许可证。</p><p><br/></p><p>GitHub 初始化项目时可以选择生成 .gitignore 文件，选择许可证，初始化 README.md 文件，切换至本地的项目目录后，按如下步骤即可将目录上传至 GitHub：</p><p><br/></p><p>&gt;git init # 初始化仓库</p><p>&gt;git remote set-url origin --push --add git@github.com:jayxhj/geosso.git # 添加远程追踪仓库地址</p><p>&gt; git add .</p><p>&gt; git commit</p><p>&gt; git push origin master</p><p>提交至 Packagist</p><p><br/></p><p>Packagist 为 composer 默认获取包元数据信息的地址，从 Packagist 获取到元数据信息后，再从 GitHub 上拉取代码。因此，当把你开发的包上传至 GitHub 后还需要将其在 Packagist 注册，这样全世界的人都能通过 composer 去拉去你的代码了。</p><p><br/></p><p>提交至 Packagist 只需三个步骤：</p><p><br/></p><p>注册帐号</p><p>在 https://packagist.org/packages/submit 提交开发包</p><p>设置 webhook 以便提交包更新后能及时地同步至 Packagist</p><p>自此，一个基本的包开发就结束了。通过 composer 来管理 PHP 的依赖，通过编写 composer package 去扩展自己的类库，通过引入其他的类库来填充自己的功能，就不用重复造轮子了。</p><p><br/></p>
{% endraw %}

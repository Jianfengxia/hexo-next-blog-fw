---
title: "*saltstack  debug的技巧"
date: 2017-08-08 08:00:00
updated: 2017-08-07 13:59:19
tags: ["Saltstack"]
---
{% raw %}
<p>运行 Salt 一旦 shim 发现 Python 解释器，并且一旦 salt_state.tgz tar 包部署完毕（如果有必要的话），最终就可以执行 Salt 命令。和传统的 Salt 运行方式不一样，它不需要以守护进程（daemon）方式运行，而是以本地模式（local mode）方式执行 salt-call 命令，就像它是一个 Minion 一样。输出结果会通过 Master 端的 Salt SSH 客户端收集、解析并展示给用户。我们可以以 trace 日志级别来查看运行信息。</p><p><br/></p><p>[root@localhost salt]# <span style="color: rgb(255, 0, 0);">salt &#39;s*&#39; test.ping --log-level trace</span></p><p>[DEBUG &nbsp; ] Reading configuration from /etc/salt/master</p><p>[DEBUG &nbsp; ] Missing configuration file: /root/.saltrc</p><p>[TRACE &nbsp; ] None of the required configuration sections, &#39;logstash_udp_handler&#39; and &#39;logstash_zmq_handler&#39;, were found the in the configuration. Not loading the Logstash logging handlers module.</p><p>[DEBUG &nbsp; ] Configuration file path: /etc/salt/master</p><p>[WARNING ] Insecure logging configuration detected! Sensitive data may be logged.</p><p>[DEBUG &nbsp; ] Reading configuration from /etc/salt/master</p><p>[DEBUG &nbsp; ] Missing configuration file: /root/.saltrc</p><p>[DEBUG &nbsp; ] MasterEvent PUB socket URI: ipc:///var/run/salt/master/master_event_pub.ipc</p><p>[DEBUG &nbsp; ] MasterEvent PULL socket URI: ipc:///var/run/salt/master/master_event_pull.ipc</p><p>[DEBUG &nbsp; ] Sending event - data = {&#39;_stamp&#39;: &#39;2017-08-07T05:54:21.903494&#39;}</p><p>[TRACE &nbsp; ] get_event() received = {&#39;tag&#39;: &#39;salt/event/new_client&#39;, &#39;data&#39;: {&#39;_stamp&#39;: &#39;2017-08-07T05:54:21.903494&#39;}}</p><p>[TRACE &nbsp; ] func get_cli_event_returns()</p><p>[DEBUG &nbsp; ] LazyLoaded mysql.get_load</p><p>[DEBUG &nbsp; ] LazyLoaded config.option</p><p>[INFO &nbsp; &nbsp;] Using default for mysql ssl_key</p><p>[INFO &nbsp; &nbsp;] Using default for mysql ssl_cert</p><p>[INFO &nbsp; &nbsp;] Using default for mysql ssl_ca</p><p>[DEBUG &nbsp; ] get_iter_returns for jid 20170806225421938741 sent to set([&#39;salt-master&#39;]) will timeout at 22:54:27.014845</p><p>[TRACE &nbsp; ] get_event() received = {&#39;tag&#39;: &#39;salt/job/20170806225421938741/new&#39;, &#39;data&#39;: {&#39;tgt_type&#39;: &#39;glob&#39;, &#39;jid&#39;: &#39;20170806225421938741&#39;, &#39;tgt&#39;: &#39;s*&#39;, &#39;_stamp&#39;: &#39;2017-08-07T05:54:21.938959&#39;, &#39;user&#39;: &#39;root&#39;, &#39;arg&#39;: [], &#39;fun&#39;: &#39;test.ping&#39;, &#39;minions&#39;: [&#39;salt-master&#39;]}}</p><p>[TRACE &nbsp; ] get_event() received = {&#39;tag&#39;: &#39;salt/job/20170806225421938741/ret/salt-master&#39;, &#39;data&#39;: {&#39;fun_args&#39;: [], &#39;jid&#39;: &#39;20170806225421938741&#39;, &#39;return&#39;: True, &#39;retcode&#39;: 0, &#39;success&#39;: True, &#39;cmd&#39;: &#39;_return&#39;, &#39;_stamp&#39;: &#39;2017-08-07T05:54:22.062106&#39;, &#39;fun&#39;: &#39;test.ping&#39;, &#39;id&#39;: &#39;salt-master&#39;}}</p><p>[DEBUG &nbsp; ] jid 20170806225421938741 return from salt-master</p><p>[DEBUG &nbsp; ] LazyLoaded nested.output</p><p>[TRACE &nbsp; ] data = {&#39;salt-master&#39;: True}</p><p>salt-master:</p><p>&nbsp; &nbsp; True</p><p>[DEBUG &nbsp; ] jid 20170806225421938741 found all minions set([&#39;salt-master&#39;])</p><p>[root@localhost salt]#&nbsp;</p><p><br/></p>
{% endraw %}
